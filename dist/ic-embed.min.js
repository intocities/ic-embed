!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).IC=e()}}((function(){var e=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},t=e((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Embed=t.TOUR_OPTIONS_PERMITTED_KEYS=void 0;var i=n({});t.TOUR_OPTIONS_PERMITTED_KEYS=new Set(["scene","ath","atv","z"]);var r=function(){function e(e,t,n){var i;if(!e||!(null===(i=null==e?void 0:e.contentWindow)||void 0===i?void 0:i.postMessage))throw new TypeError("First parameter must be a HTMLIFrameElement!");if(!t)throw new TypeError("Second parameter must be an ApiCredentials!");this.apiCredentials=t;var r={iframe:e};this.options=r,n&&(this.tourOptions=n),(0,s.addStyles)()}return e.initInContainer=function(t,n,i){var r=document.createElement("iframe");return r.id="ic-tour-".concat(n.id),r.allowFullscreen=!0,r.allow="fullscreen",r.className="ic-embed__iframe",t.innerHTML="",t.appendChild(r),new e(r,n,i)},e.urlWithTourOptions=function(e,n){if(!n)return e;var i=Object.entries(n).filter((function(e){var n=e[0];return e[1],t.TOUR_OPTIONS_PERMITTED_KEYS.has(n)})).map((function(e){var t=e[0],n=e[1];return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}));return"".concat(e,"#").concat(i.join("&"))},Object.defineProperty(e.prototype,"tour",{get:function(){return this.tourProxy||(this.tourProxy=new i.TourProxy(this.options.iframe)),this.tourProxy},enumerable:!1,configurable:!0}),e.prototype.mount=function(){return this.options.iframe.className="ic-embed__iframe",this.options.iframe.src=e.urlWithTourOptions(this.apiCredentials.iframeUrl,this.tourOptions),this.options.iframe},e}();t.Embed=r})),n=e((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TourProxy=void 0;var i=t({}),r=new Set(["ic.sceneChanged","ic.ready"]),o=function(){function e(e){var t,n=this;if(!e||!(null===(t=null==e?void 0:e.contentWindow)||void 0===t?void 0:t.postMessage))throw new TypeError("First parameter must be a HTMLIFrameElement!");this.iframe=e,window.addEventListener("message",(function(e){n.receiveMessage(e)}),!1)}return e.prototype.changeScene=function(e,t,n){if(!e)throw new TypeError("sceneId is required!");var i={name:"changeScene",sceneId:e};if(null!=t)if("string"==typeof t)i.ath=parseFloat(t);else{if("number"!=typeof t)throw new TypeError("ath must be number or string");i.ath=t}if(null!=n)if("string"==typeof n)i.atv=parseFloat(n);else{if("number"!=typeof n)throw new TypeError("atv must be number or string");i.atv=n}return this.postMessage(i),i},e.prototype.params=function(){var e=this.iframe.src.split("#");if(1===e.length)return{};for(var t=e[1].split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("="),a=decodeURIComponent(o[0]);if(i.TOUR_OPTIONS_PERMITTED_KEYS.has(a)){var s=decodeURIComponent(o[1]);n[a]=s}}return n},Object.defineProperty(e.prototype,"iframeOrigin",{get:function(){return this.iframe.src.split("/").slice(0,3).join("/")},enumerable:!1,configurable:!0}),e.prototype.assertAllowedOrigin=function(e){if(e!==this.iframeOrigin)throw new Error("Discarding incoming message; untrusted event origin.")},e.prototype.dispatchEvent=function(e,t){console.debug("dispatchEvent",e,t),this.iframe.dispatchEvent(new window.CustomEvent(e,{detail:t}))},e.prototype.receiveMessage=function(e){console.debug("receiveMessage",e),this.assertAllowedOrigin(e.origin),r.has(e.data.name)?this.dispatchEvent(e.data.name.slice(3),e.data):console.debug("Discarding incoming message; unknown event name.")},e.prototype.postMessage=function(e){console.debug("postMessage",e,this.iframeOrigin),this.iframe.contentWindow.postMessage(e,this.iframeOrigin)},e}();n.TourProxy=o})),i={},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(i,"__esModule",{value:!0}),i.ApiCredentials=void 0;var a=function(){function e(e,t,n){if(!e||!t||!n)throw new TypeError("id, key and baseUrl are required");this.id=e,this.key=t,this.baseUrl=n.endsWith("/")?n:"".concat(n,"/")}return e.prototype.validate=function(){return r(this,void 0,void 0,(function(){var e,t=this;return o(this,(function(n){switch(n.label){case 0:return this.apiResponse?[3,2]:(e=this,[4,this.request()]);case 1:e.apiResponse=n.sent(),n.label=2;case 2:return[2,new Promise((function(e,n){try{if(!t.isValid())throw new Error("invalid credentials");e(!0)}catch(i){n(i)}}))]}}))}))},e.prototype.isValid=function(){if(!this.apiResponse)throw new Error("must call validate() before calling isValid().");if("string"==typeof this.apiResponse.origin&&this.apiResponse.origin!==window.location.origin)throw new Error("Can't be used on this origin!");return this.apiResponse.poi.tour_present&&this.apiResponse.poi.id===this.id},e.prototype.request=function(){return fetch("".concat(this.baseUrl,"api/pois/").concat(this.id,"/embed/").concat(this.key),{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},referrer:"origin"}).then((function(e){if(200===e.status)return e.json();throw new Error("unsuccessful data request with status: ".concat(e.status))})).catch((function(e){throw e}))},Object.defineProperty(e,"cdnUrl",{get:function(){return"https://cdn.intocities.com"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iframeUrl",{get:function(){return"".concat(this.baseUrl,"embed/").concat(this.id.toString(),"/").concat(this.key)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imageUrl",{get:function(){var e,t,n;return null===(n=null===(t=null===(e=this.apiResponse)||void 0===e?void 0:e.poi)||void 0===t?void 0:t.thumbnail_urls)||void 0===n?void 0:n.landscape},enumerable:!1,configurable:!0}),e}();i.ApiCredentials=a;var s={};Object.defineProperty(s,"__esModule",{value:!0}),s.addStyles=s.STYLE_ELEMENT_ID=void 0;s.STYLE_ELEMENT_ID="ic-embed-styles",s.addStyles=function(){if(!document.getElementById(s.STYLE_ELEMENT_ID)){var e=document.createElement("style");e.id=s.STYLE_ELEMENT_ID,e.innerHTML="\n.ic-preview {\n  --ic-preview__button-width: 8em;\n  --ic-preview__button-height: 4.5em;\n  --ic-preview__button-border-radius: 3px;\n  --ic-preview__button-font-size: 2em;\n  --ic-preview__button-color-back: hsl(0deg 0% 0% / 25%);\n  --ic-preview__button-color-back--hover: hsl(0deg 0% 0% / 2.5%);\n\n  --ic-preview__button-color-front: hsl(0deg 0% 100% / 97.5%);\n  --ic-preview__button-color-front--hover: hsl(0deg 0% 100% / 100%);\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  cursor: pointer;\n}\n\n.ic-preview__wrapper {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.ic-preview__image {\n  z-index: 1;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  opacity: 0.975;\n  transition: opacity 0.3s ease;\n}\n\n.ic-preview:focus .ic-preview__image,\n.ic-preview:hover .ic-preview__image {\n  opacity: 1;\n}\n\nic-button {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 2;\n  display: block;\n  max-width: var(--ic-preview__button-width);\n  max-height: var(--ic-preview__button-height);\n  font-size: var(--ic-preview__button-font-size);\n  color: var(--ic-preview__button-color-front);\n  text-align: center;\n  text-decoration: none;\n  text-shadow: 0 0 3px #000;\n  cursor: pointer;\n  background-color: transparent;\n  border: 0;\n  transition: all 0.3s ease;\n  transform: translate(-50%, -50%);\n  backdrop-filter: blur(0.25px);\n}\n\n.ic-preview:focus ic-button,\n.ic-preview:hover ic-button,\nic-button:focus,\nic-button:hover {\n  color: var(--ic-preview__button-color-front--hover);\n  text-shadow: 0 0 4px #000000f0;\n}\n\n.ic-embed__iframe {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  border: none;\n}",document.head.appendChild(e)}};var c={};function u(e){var t=document.createElement("link");t.href=e.href,t.rel=e.rel,e.type&&(t.type=e.type),e.as&&(t.as=e.as),document.head.appendChild(t)}Object.defineProperty(c,"__esModule",{value:!0}),c.batchAddLinksToHead=void 0,c.batchAddLinksToHead=function(e){e.forEach((function(e){u(e)}))};var l={};Object.defineProperty(l,"__esModule",{value:!0}),l.Preview=void 0;var d=t({}),p=function(){function e(e,t,n){var i=this;if(!e||!t)throw new TypeError("Parameters must be a HTMLElement and ApiCredentials!");this.container=e,this.apiCredentials=t,this.buttonText=(null==n?void 0:n.buttonText)||"Starte Rundgang",this.preload(),this.container.addEventListener("click",(function(){i.mountEmbed(n)}))}return e.prototype.mount=function(){(0,s.addStyles)(),this.block=document.createElement("div"),this.block.className="ic-preview";var e=document.createElement("div");e.className="ic-preview__wrapper";var t=document.createElement("img");t.className="ic-preview__image--loading",t.alt="",this.apiCredentials.imageUrl&&(t.className="ic-preview__image",t.loading="lazy",t.src=this.apiCredentials.imageUrl);var n=document.createElement("ic-button",{is:"button"});return n.innerText=this.buttonText,e.appendChild(n),e.appendChild(t),this.block.appendChild(e),this.container.appendChild(this.block),this.container},e.prototype.mountEmbed=function(e){return this.embed||(this.embed=d.Embed.initInContainer(this.block,this.apiCredentials,e),this.embed.mount()),this.embed},e.prototype.preload=function(){(0,c.batchAddLinksToHead)([{rel:"preconnect",href:this.apiCredentials.baseUrl},{rel:"dns-prefetch",href:i.ApiCredentials.cdnUrl},{rel:"prerender",href:this.apiCredentials.iframeUrl},{rel:"prefetch",href:this.apiCredentials.iframeUrl}])},e}();l.Preview=p;var h={};Object.defineProperty(h,"__esModule",{value:!0}),h.tour=h.preview=h.embed=void 0;var f=t({}),v=n({});return h.embed=function(e,t,n){var r=t.id,o=t.key,a=t.baseUrl,s=void 0===a?"https://intocities.com":a,c=new i.ApiCredentials(r,o,s);return c.validate().then((function(){var t=new f.Embed(e,c,n);return t.mount(),t})).catch((function(e){throw e}))},h.preview=function(e,t,n){var r=t.id,o=t.key,a=t.baseUrl,s=void 0===a?"https://intocities.com":a,c=new i.ApiCredentials(r,o,s);return c.validate().then((function(){var t=new l.Preview(e,c,n);return t.mount(),t})).catch((function(e){throw e}))},h.tour=function(e){return new v.TourProxy(e)},h}));