!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).IC=e()}}((function(){var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(a){r=[6,a],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},n=function(){function n(e,t,n){if(!e||!t||!n)throw new TypeError("id, key and baseUrl are required");this.id=e,this.key=t,this.baseUrl=n.endsWith("/")?n:"".concat(n,"/")}return n.prototype.validate=function(){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return this.apiResponse?[3,2]:(e=this,[4,this.fetchData()]);case 1:e.apiResponse=t.sent(),t.label=2;case 2:return[2,this.isValid()]}}))}))},n.prototype.isValid=function(){var e;if(!(null===(e=this.apiResponse)||void 0===e?void 0:e.poi))return!1;if("string"==typeof this.apiResponse.origin&&this.apiResponse.origin!==window.location.origin)throw new Error("Can't be used on this origin!");return this.apiResponse.poi.tour_present&&this.apiResponse.poi.id===this.id},n.prototype.fetchData=function(){return fetch("".concat(this.baseUrl,"api/pois/").concat(this.id,"/embed/").concat(this.key),{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},referrer:"origin"}).then((function(e){if(200===e.status)return e.json();throw new Error("unsuccessful data request with status: ".concat(e.status))})).catch((function(e){throw e}))},Object.defineProperty(n.prototype,"cdnUrl",{get:function(){return"https://cdn.intocities.com"},enumerable:!1,configurable:!0}),n.prototype.iframeUrl=function(){return"".concat(this.baseUrl,"/embed/").concat(this.id.toString(),"/").concat(this.key)},n}(),i={};function o(e){var t=document.createElement("link");t.href=e.href,t.rel=e.rel,e.type&&(t.type=e.type),e.as&&(t.as=e.as),document.head.appendChild(t)}Object.defineProperty(i,"__esModule",{value:!0}),i.batchAddLinksToHead=i.assignStyles=void 0,i.assignStyles=function(e,t){Object.keys(t).forEach((function(n){e.style.setProperty(n,t[n])}))},i.batchAddLinksToHead=function(e){e.forEach((function(e){o(e)}))};var r={width:"100%",height:"100%",border:"none",overflow:"hidden"},s=function(){function e(e){var t,n=this;if(!e||!(null===(t=null==e?void 0:e.contentWindow)||void 0===t?void 0:t.postMessage))throw new TypeError("Parameter must be a HTMLIFrameElement!");var i={iframe:e,iframeOrigin:e.src.split("/").slice(0,3).join("/")};this.options=i,console.log("ICEmbed initialized with options",this.options),window.addEventListener("message",(function(e){n.receiveMessage(e)}),!1)}return e.init=function(t,n,o){var s=document.createElement("iframe");return s.id="ic-tour-".concat(n.id),s.src=n.iframeUrl(),s.allowFullscreen=!0,s.allow="fullscreen",i.assignStyles(s,r),t.replaceWith(s),new e(s)},e.prototype.assertAllowedOrigin=function(e){if(e!==this.options.iframeOrigin)throw new Error("Discarding incoming message; untrusted event origin.")},e.prototype.dispatchEvent=function(e,t){console.log("dispatchEvent",e,t),this.options.iframe.dispatchEvent(new window.CustomEvent(e,{detail:t}))},e.prototype.receiveMessage=function(e){console.log("receiveMessage",e),this.assertAllowedOrigin(e.origin),this.dispatchEvent(e.data.name,e.data)},e.prototype.postMessage=function(e){console.log("postMessage",e,this.options.iframeOrigin),this.options.iframe.contentWindow.postMessage(e,this.options.iframeOrigin)},e.prototype.params=function(){var e=this.options.iframe.src.split("#");if(1===e.length)return{};for(var t=e[1].split("&"),n={},i=0;i<t.length;i++){var o=t[i].split("="),r=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]);n[r]=s}return n},e.prototype.changeScene=function(e,t,n){if("string"==typeof t)t=parseFloat(t);else if("number"!=typeof t)throw new TypeError("ath must be number or string");if("string"==typeof n)n=parseFloat(n);else if("number"!=typeof n)throw new TypeError("atv must be number or string");var i={name:"changeScene",sceneId:e,ath:t,atv:n};this.postMessage(i)},e}(),a={position:"relative",width:"100%",height:"100%",overflow:"hidden",cursor:"pointer"},c={position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},l={width:"100%",height:"100%","object-fit":"cover","z-index":"1"},u={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","z-index":"2","border-radius":"0.5em"},p=function(){function e(e,t,n){var i=this;this.container=e,this.apiCredentials=t,this.buttonText=n,this.preload(),this.container.addEventListener("click",(function(){i.embed()}))}return e.prototype.add=function(){i.assignStyles(this.container,a);var e=document.createElement("div");i.assignStyles(e,c);var t=document.createElement("img");t.loading="lazy",t.src=this.imageUrl,i.assignStyles(t,l);var n=document.createElement("button");n.innerText=this.buttonText,i.assignStyles(n,u),e.appendChild(n),e.appendChild(t),this.container.appendChild(e)},e.prototype.embed=function(){return s.init(this.container,this.apiCredentials,this.buttonText)},e.prototype.preload=function(){i.batchAddLinksToHead([{rel:"preconnect",href:this.apiCredentials.baseUrl},{rel:"dns-prefetch",href:this.apiCredentials.cdnUrl},{rel:"preload",href:this.imageUrl,as:"image"}])},Object.defineProperty(e.prototype,"imageUrl",{get:function(){return this.apiCredentials.apiResponse.poi.thumbnail_urls.landscape},enumerable:!1,configurable:!0}),e}(),d={};return Object.defineProperty(d,"__esModule",{value:!0}),d.preview=d.embed=void 0,d.embed=function(e){return new s(e)},d.preview=function(e,t){var i=t.id,o=t.key,r=t.baseUrl,s=void 0===r?"https://intocities.com":r,a=t.buttonText,c=void 0===a?"Start Virtual Tour":a,l=new n(i,o,s);return l.validate().then((function(t){if(t){var n=new p(e,l,c);return n.add(),n}throw new Error("validation failed")}))},d}));